---
name: Performance Optimizations
status: open
created: 2025-11-17T16:47:44Z
updated: 2025-11-17T16:58:05Z
github: https://github.com/varunisrani/sdjd2/issues/4
depends_on: [5, 6, 7, 2]
parallel: false
conflicts_with: []
---

# Task 4: Performance Optimizations

## Description

Implement lazy loading, image optimization, and CSS animation performance tuning. This task focuses on optimizing the application performance through Next.js Image component integration, low-quality placeholder implementation, and ensuring all animations leverage GPU acceleration for 60fps performance.

## Acceptance Criteria

- Album artwork lazy loaded with Next.js Image component
- Low-quality placeholders (LQIP) implemented
- All animations use CSS transforms (translate, scale, opacity)
- Transition durations â‰¤200ms
- No animation jank (60fps verified)

## Technical Details

### Image Optimization

#### Next.js Image Component Migration

- **Replace all `<img>` tags with `<Image>` component**
  - Locations to update:
    - `components/MusicPlayer.tsx` - Album artwork
    - `components/TrackList.tsx` - Album artwork thumbnails
    - Any other components with static/dynamic images

- **Implementation Pattern**
  ```typescript
  import Image from 'next/image';

  <Image
    src={albumArtUrl}
    alt="Album artwork"
    width={400}
    height={400}
    loading="lazy"
    placeholder="blur"
    blurDataURL={blurHash}
    quality={75}
    sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"
  />
  ```

#### Low-Quality Image Placeholders (LQIP)

- **Generate blur data URLs**
  - Use `plaiceholder` library (optional) or base64 encoded tiny images
  - Install: `npm install plaiceholder` (if not already present)
  - Alternative: Create 10x10px base64-encoded JPEG placeholders

- **Placeholder Strategy**
  - Show blurred placeholder while image loads
  - Fade transition: 300ms ease-out (use CSS filter transition)
  - No layout shift during fade (use same aspect ratio)

#### Image Format & Compression

- **Format Strategy**
  - Modern formats: WebP with JPEG fallback (Next.js handles automatically)
  - Quality levels:
    - Album artwork: quality 75 (good balance)
    - Thumbnails: quality 60 (smaller file size)

- **Responsive Sizes**
  - Mobile (320-640px): 100vw (full viewport width)
  - Tablet (641-1024px): 50vw (half viewport)
  - Desktop (1025px+): 33vw (third of viewport)

### CSS Animation Performance

#### GPU-Accelerated Transforms

- **Transform-based Animations**
  - Only use: `translate()`, `scale()`, `rotate()`, `opacity`
  - Avoid: `left`, `top`, `width`, `height`, `margin`, `padding` in animations
  - These properties force repaints; transforms use GPU acceleration

- **Implementation Pattern**
  ```css
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .card-enter {
    animation: slideIn 200ms ease-out;
    will-change: transform, opacity;
  }
  ```

#### Transition Durations

- **Maximum Duration: 200ms**
  - Rationale: Meets "subtle & fast" requirement
  - Faster feels more responsive (100-150ms preferred)
  - Examples:
    - Hover states: 150ms
    - Modal fade-in: 200ms
    - Progress bar updates: 100ms (or disable animation)

#### Animation Performance Auditing

- **CSS Animation Best Practices**
  - Use `will-change: transform, opacity` to hint browser for GPU acceleration
  - Remove `will-change` after animation completes (property has performance cost)
  - Avoid animating too many elements simultaneously
  - Test on mobile devices (Chrome DevTools Performance tab)

### Performance Metrics & Verification

#### Lighthouse Targets

- **Performance Score: 90+**
  - Current baseline to be measured before this task
  - Target improvements:
    - FCP: <1.5s on 3G
    - LCP: <2.5s (mobile), <1.2s (desktop)
    - CLS: 0 (no layout shifts)
    - TBT: <200ms

#### Core Web Vitals

- **First Contentful Paint (FCP)**
  - Target: <1.5s on 3G mobile
  - Measured: Lighthouse throttling (3G, 4x CPU slowdown)
  - Image lazy loading contributes to this

- **Largest Contentful Paint (LCP)**
  - Target: <2.5s (mobile), <1.2s (desktop)
  - Ensure album artwork lazy loads correctly

- **Cumulative Layout Shift (CLS)**
  - Target: 0 (perfect score)
  - Ensure placeholder images use correct aspect ratio (no shift on load)

#### Frame Rate Verification

- **60fps Animations**
  - Use Chrome DevTools Performance tab to record 60 seconds
  - Run animations, measure frame drops
  - Target: No frames below 60fps during animations
  - Common issues: JavaScript blocking, too many repaints

### Implementation Checklist - Images

- [ ] Find all `<img>` tags in components
- [ ] Replace with Next.js `<Image>` component
- [ ] Add `loading="lazy"` to all images
- [ ] Generate or add `placeholder="blur"` with `blurDataURL`
- [ ] Set appropriate `quality` levels (75 for artwork, 60 for thumbnails)
- [ ] Add `sizes` prop for responsive images
- [ ] Test image loading on slow 3G (DevTools throttling)
- [ ] Verify no layout shift during image fade-in (use same aspect ratio)

### Implementation Checklist - Animations

- [ ] Audit all CSS animations in globals.css and components
- [ ] Replace layout-based animations (left, top, width) with transforms
- [ ] Ensure all animations use only: translate, scale, rotate, opacity
- [ ] Set max duration to 200ms (reduce longer durations)
- [ ] Add `will-change: transform, opacity` to animated elements
- [ ] Test 60fps performance with DevTools Performance tab
- [ ] Verify no animation jank on mobile devices

### Implementation Checklist - Performance Testing

- [ ] Run Lighthouse audit (target: Performance 90+)
- [ ] Measure FCP with 3G throttling (target: <1.5s)
- [ ] Measure LCP (target: <2.5s mobile)
- [ ] Verify CLS score (target: 0)
- [ ] Test on real mobile devices (iOS/Android)
- [ ] Verify animations at 60fps (DevTools Performance)
- [ ] Check bundle size increase (target: <15KB gzipped total for epic)

## Effort

**Size:** M (Medium)
**Estimated Duration:** 2-3 days

## Definition of Done

- [ ] Lighthouse Performance Score 90+ (verified)
- [ ] FCP <1.5s on 3G mobile (measured via Lighthouse)
- [ ] All animations verified at 60fps (no jank)
- [ ] Image lazy loading verified (loading="lazy" attribute)
- [ ] LQIP blur placeholders implemented and tested
- [ ] No layout shift on image load (CLS = 0)
- [ ] Code reviewed and merged to main branch
- [ ] Performance improvements documented in PR
